<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	  xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>Workspace Management System | HOME</title>
	<!-- Tell the browser to be responsive to screen width -->
	<meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
	<!-- Bootstrap 3.3.6 -->
	<link rel="stylesheet" th:href="@{/css/style.css}">
	<link rel="stylesheet" th:href="@{/css/bootstrap.min.css}">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.5.0/css/font-awesome.min.css">
	<!-- Ionicons -->
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/ionicons/2.0.1/css/ionicons.min.css">
	<!-- Theme style -->
	<link rel="stylesheet" th:href="@{/css/AdminLTE.min.css}">
	<!-- AdminLTE Skins. Choose a skin from the css/skins
         folder instead of downloading all of them to reduce the load. -->
    <link rel="stylesheet" th:href="@{/css/_all-skins.min.css}">
    
    <link rel="stylesheet" th:href="@{/css/dataTables.bootstrap.css}">
	<!-- Theme style -->
	<!-- iCheck -->
	<link rel="stylesheet" th:href="@{/css/blue.css}">
	
	<link rel="icon" type="image/png" sizes="16x16" th:href="@{/images/favicon.png}"/>
	<!--[if lt IE 9]>
	<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
	<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.11.2/moment.min.js"></script>
	<![endif]-->
</head>
<body class="hold-transition skin-blue sidebar-mini">
 <div class="se-pre-con"></div>
<div class="wrapper">

	<header class="main-header">
		<!-- Logo -->
		<a th:href="@{/home}" class="logo">
			<!-- mini logo for sidebar mini 50x50 pixels -->
			<span class="logo-mini"><b>W</b>MS</span>
			<!-- logo for regular state and mobile devices -->
			<span class="logo-lg" th:utext="${auth.role.role}"> </span>

		</a>
		<!-- Header Navbar: style can be found in header.less -->
		<nav class="navbar navbar-static-top">
			<!-- Sidebar toggle button
			<a href="#" class="sidebar-toggle" data-toggle="offcanvas" role="button">
				<span class="sr-only">Toggle navigation</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</a>-->

			<div class="navbar-custom-menu">
				<ul class="nav navbar-nav">
					<!-- User Account: style can be found in dropdown.less -->
					<li class=" user user-menu">
						<img th:src="@{/images/avatar5.png}" class="user-image" alt="User Image">
							<!--  <a href="#" class="dropdown-toggle" data-toggle="dropdown">
							<img th:src="@{/images/avatar5.png}" class="user-image" alt="User Image">
						<span class="hidden-xs" th:utext="${auth.name}"></span>
						</a>-->
						<ul class="dropdown-menu">
							<!-- User image -->
							<li class="user-header">
								<img th:src="@{/images/avatar5.png}" class="img-circle" alt="User Image">

								<p>
									<span class="hidden-xs" th:utext="${auth.name}"></span>
									<small><span class="hidden-xs" th:utext="${auth.email}"></span></small>
								</p>
							</li>
							<!-- Menu Body --
                            <!-- Menu Footer-->
							<li class="user-footer">
								<div class="pull-left">
									<!-- <a th:href="@{/myprofile/inf}" class="btn btn-primary btn-flat">Profile</a>-->
									<a  th:href="@{/myprofile/change_password(id=${auth.id})}"><i class="fa fa-gears"></i> Change
										Password</a>
								</div>
								<!-- <div class="col-xs-offset-1 col-xs-4 text-center">
									<a  th:href="@{/myprofile/change_password(id=${auth.id})}"><i class="fa fa-gears"></i> Change
										Password</a>
								</div>-->
								<div class="pull-right">
									<a th:href="@{/logout}" class="btn btn-danger btn-flat">Sign out</a>
								</div>
							</li>
						</ul>
					</li>
					<li>
            <a href="#" data-toggle="control-sidebar"><i class="fa fa-gear"></i></a>
          </li>
				</ul>
			</div>
		</nav>
		
	</header>
	
	
	
	<aside class="main-sidebar" th:insert="/navigator.html"></aside>
	<!-- Content Wrapper. Contains page content -->
	<div class="content-wrapper">
		<!-- Content Header (Page header) -->
		<section class="content-header">
			<!-- <h1>
				Home Page
			</h1>-->
		</section>

		<!-- Main content -->
		<section class="content">
			<div th:if="${control == 'Super Admin'}" >
				<div th:insert="/admin_home.html"></div>
			</div>
			<div th:if="${control == 'Facility Admin'}" >
				<div th:insert="/fa_home.html"></div>		
			</div>
			<div th:if="${control == 'Project Manager'}" >
				<div th:insert="/pm_home.html"></div>		
			</div>
          <!-- /.box -->
        </div>

			<!--<div class="row">
				<div class="col-lg-offset-3 col-lg-4 col-xs-6">
					<h2 class="headline text-black"> WELCOME <span class="hidden-xs" th:utext="${auth.name}"></span></h2>
					
				</div>
			</div>
			<div class="row">

				<div class="col-lg-offset-3 col-md-4">
					
					<div class="box box-widget widget-user">
					
						<div class="widget-user-header bg-purple-active">
							<h3 class="widget-user-username"> <span class="hidden-xs" th:utext="${auth.name}"></span></h3>
							<h5 class="widget-user-desc"> <span class="hidden-xs" th:utext="${auth.role.role}"></span></h5>
						</div>
						<div class="widget-user-image">
							<img class="img-circle" th:src="@{/images/avatar5.png}" alt="User Avatar">
						</div>
						<div class="box-footer">
							<div class="row">
								<div class="col-sm-4 border-right">
									<div class="description-block">
									</div>
									
								</div>
								
								<div class="col-sm-4 border-right">
									 <div class="description-block">
										<h5 class="description-header"> <span class="hidden-xs">10</span></h5>
										<span class="description-text">Requests</span>
									</div>
								
								</div>
								
								<div class="col-sm-4">
									<div class="description-block">
									</div>
									
								</div>
								
							</div>
							
						</div>
					</div>
				</div>
			</div>-->

			
		</section>
		<!-- /.content -->
	</div>
<footer class="main-footer">
    <div class="pull-right hidden-xs">
      <a th:href="@{/home}">Workspace Management System</a>
    </div>
    <strong>Copyright &copy; 2019 SONY</strong> All rights
    reserved.
  </footer>
	<aside class="control-sidebar control-sidebar-dark" >
    <!-- Create the tabs -->
    
    <!-- Tab panes -->
    <div class="tab-content">
      <!-- Home tab content -->
      <div class="tab-pane" id="control-sidebar-home-tab">
        <h3 class="control-sidebar-heading">Profile Settings</h3>


      </div>
      <!-- /.tab-pane -->
      <!-- Stats tab content -->
      

      <!-- /.tab-pane -->
    </div>
  </aside>
  <!-- /.control-sidebar -->
  <!-- Add the sidebar's background. This div must be placed
       immediately after the control sidebar -->
  <div class="control-sidebar-bg"></div>
</div>
   <div class="modal fade" id="logoutModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-sm">
    <div class="modal-content">
      <div class="modal-header bg-primary">
       
        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
      </div>
      <div class="modal-body">
        <h4> &nbsp;Are you sure you want to Logout&nbsp;? </h4>
        
      </div>
      <div class="actionsBtns" style ="text-align:center;">
        
        <a th:href="@{/logout}" class="btn btn-success" >
                <span>Logout</span>
                </a>
        <button type="button" class="btn btn-danger" data-dismiss="modal" >Cancel</button>
      </div>
      <hr>
    </div>
  </div>
</div>
   <div class="modal fade" id="changepasswordModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-md">
    <div class="modal-content changePassword" style ="display:block">
      <div class="modal-header bg-primary">
       
        <h4>Change Password</h4>
      </div>
      <div class="modal-body">
                <form method="post" id="changepasswordform" class="form-horizontal">
          <div class="form-group row">
            <label class="col-md-3 col-form-label" for="oldpassword">Old Password</label>
            <div class="col-md-9">           
              <!--<span id="EditSetName" class = "form-control"></span>-->
              
              <input type = "password" id="oldpassword" name = "oldpassword" class = "form-control" autocomplete = "off" required value = "">
            </div>
          </div>
      <div class="form-group row">
            <label class="col-md-3 col-form-label" for="newpassword">New Password</label>
            <div class="col-md-9">           
              <!--<span id="EditSetName" class = "form-control"></span>-->
              <input type = "password" id="newpassword" name = "newpassword" autocomplete = "off" required class = "form-control" value = "">
            </div>
          </div>
          
    
          
          
          </form>
        
      </div>
       <div class="modal-footer">
      <div class="actionsBtns" style ="float:right;">
        
     
                <button type="submit" class="btn btn-success updatepassword" th:id ="${auth.id}" >Update</button>
        <button type="button" class="btn btn-danger" data-dismiss="modal" >Cancel</button>
      </div>
      </div>
     
    </div>
      <div class="modal-content changedPassword" style = "display:none;">
      <div class="modal-header bg-primary">
        
        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
      </div>
      <div class="modal-body">
        <p><h2 style = "text-align : center; color :#52bb56; "><i class="mdi mdi-checkbox-marked-circle-outline"></i><br />Password Changed</h2></p>
        
      </div>
      <div class="modal-footer" >
       
        <button type="button" class="btn btn-danger canceluser" data-dismiss="modal" >Close</button> 
      </div>
    
    </div>
  </div>
</div>
<!-- ./wrapper -->
<!-- jQuery 2.2.3 -->
<script th:src="@{/js/jquery-2.2.3.min.js}"></script>
<!-- Bootstrap 3.3.6 -->
<script th:src="@{/js/bootstrap.min.js}"></script>

<script th:src="@{/js/jquery.dataTables.min.js}"></script>
<script th:src="@{/js/dataTables.bootstrap.min.js}"></script>
<script th:src="@{/js/jquery.slimscroll.min.js}"></script>
<!-- FastClick -->

<!-- AdminLTE App -->
<script th:src="@{/js/app.min.js}"></script>
<!-- AdminLTE for demo purposes -->
<script th:src="@{/js/demo.js}"></script>
<script th:src="@{/js/scripts.js}"></script>

<script>

    
$(function () {
    $('#allusers').DataTable();
});


$(window).load(function(){
	console.log('element present'+$('#allusers').length);
	if($('#allusers').length>0){
		$('#allusers').DataTable();
		getAdminResponse(0); //for initial load get all user data so set value to 0
	}
	if($('#fahome').length>0){
		getFAResponse();
	}
	if($('#pmhome').length>0){
		getPMResponse();
	}
 });
 
function getPMResponse(){
	  var requestDetails = '/PM/pmdashboard';
	   	$.ajax({
	  	    type: 'GET',
	  	    url: requestDetails,
	  	    contentType: "application/json",
	  	    dataType: 'json',
	  	    success: function (data) {
	  	    	console.log(data);
	  	    	$('#todayRequest').html(data.todayRequest);
	  	    	$('#allRequest').html(data.allRequest);
	  	    	$('#thisMonth').html(data.thisMonth);
	  	    	$('#pending').html(data.pending);
	  	    	$('#allocated').html(data.allocated);
	  	    	$('#assigned').html(data.assigned);
	  	    	$('#rejected').html(data.rejected);
	  	    },
	  	    
	  	    error: function (e) {
	  	      console.log("There was an error with your request...");
	  	      console.log("error: " + JSON.stringify(e));
	  	    }
	  	  });
}

function getFAResponse(){
	  var requestDetails = '/FM/facilityadmincount';
	   	$.ajax({
	  	    type: 'GET',
	  	    url: requestDetails,
	  	    contentType: "application/json",
	  	    dataType: 'json',
	  	    success: function (data) {
	  	    	console.log(data);
	  	    	$('#todayRequest').html(data.todayRequest);
	  	    	$('#allRequest').html(data.allRequest);
	  	    	$('#thisMonth').html(data.thisMonth);
	  	    	$('#pending').html(data.pending);
	  	    	$('#allocated').html(data.allocated);
	  	    	$('#assigned').html(data.assigned);
	  	    	$('#rejected').html(data.rejected);
	  	    },
	  	    
	  	    error: function (e) {
	  	      console.log("There was an error with your request...");
	  	      console.log("error: " + JSON.stringify(e));
	  	    }
	  	  });
}
  
  function getAdminResponse(roleId){
	  var requestDetails = '/superadmin/rolesinfo?roleId='+roleId;
	   	$.ajax({
	  	    type: 'GET',
	  	    url: requestDetails,
	  	    contentType: "application/json",
	  	    dataType: 'json',
	  	    success: function (data) {
	  	    	console.log(data);
	  	    	$('#pmCount').html(data.pmCount);
	  	    	$('#faCount').html(data.faCount);
	  	    	$('#dmCount').html(data.dmCount);
	  	    	$('#totalCount').html(data.totalCount);
	  	    	populateDataTable(data.userDetailsResponse);
	  	    },
	  	    
	  	    error: function (e) {
	  	      console.log("There was an error with your request...");
	  	      console.log("error: " + JSON.stringify(e));
	  	    }
	  	  });
  }
  
  
function populateDataTable(data) {
    console.log("populating data table...");
    $("#allusers").DataTable().clear();
    var length = Object.keys(data).length;
    console.log(length);
    for(var i = 0; i < length; i++) {
      var userDetailsResponse = data[i];
      var sno = i + 1;
      var group = getGroup(userDetailsResponse.role_id);
      console.log('userDetailsResponse'+userDetailsResponse + i);
    	   $('#allusers').dataTable().fnAddData( [
    		   sno,
    		   userDetailsResponse.firstname,
    		   userDetailsResponse.lastname,
    		   group ,
    		   userDetailsResponse.email
 	      ]);
    }
}
function getGroup(roleid){
	var group;
	if(roleid=='1'){
		group = 'Super Admin';
	}
	if(roleid=='2'){
		group = 'USER';	
		}
	if(roleid=='3'){
		group = 'Project Manager';
	}
	if(roleid=='4'){
		group = 'Facility Admin';
	}
	return group;
}
</script>




</body>
</html>