<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	  xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>Workspace Management System | DASHBOARD</title>
	<!-- Tell the browser to be responsive to screen width -->
	<meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
	<!-- Bootstrap 3.3.6 -->
	<link rel="stylesheet" th:href="@{/css/bootstrap.min.css}">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.5.0/css/font-awesome.min.css">
	<!-- Ionicons -->
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/ionicons/2.0.1/css/ionicons.min.css">
	<!-- Theme style -->
	<link rel="stylesheet" th:href="@{/css/AdminLTE.min.css}">
	<!-- AdminLTE Skins. Choose a skin from the css/skins
         folder instead of downloading all of them to reduce the load. -->
    <link rel="stylesheet" th:href="@{/css/_all-skins.min.css}">
    <link rel="stylesheet" th:href="@{/css/datepicker3.css}">
    <link rel="stylesheet" th:href="@{/css/style.css}">
	<!-- Theme style -->
	<!-- iCheck -->
	<link rel="stylesheet" th:href="@{/css/blue.css}">
	<!-- Morris chart -->
	<link rel="stylesheet" th:href="@{/css/morris.css}">
	<!-- bootstrap wysihtml5 - text editor -->
	<link rel="stylesheet" th:href="@{/css/bootstrap3-wysihtml5.min.css}">
	<link rel="icon" type="image/png" sizes="16x16" th:href="@{/images/wmsicon.png}"/>
	<!--[if lt IE 9]>
	<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
	<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.11.2/moment.min.js"></script>
	<![endif]-->
</head>
<style>
.js-legend ul {
  list-style: none;
}

.js-legend ul li {
  display: block;
  padding-left: 30px;
  position: relative;
  margin-bottom: 4px;
  border-radius: 5px;
  padding: 2px 8px 2px 28px;
  font-size: 14px;
  cursor: default;
  -webkit-transition: background-color 200ms ease-in-out;
  -moz-transition: background-color 200ms ease-in-out;
  -o-transition: background-color 200ms ease-in-out;
  transition: background-color 200ms ease-in-out;
}

.js-legend li span {
  display: block;
  position: absolute;
  left: 0;
  top: 0;
  width: 20px;
  height: 100%;
  border-radius: 5px;
}

</style>
<body class="hold-transition skin-blue sidebar-mini">
 <div class="se-pre-con"></div>
<div class="wrapper">

	<header class="main-header">
		<!-- Logo -->
		<a th:href="@{/home}" class="logo">
			<!-- mini logo for sidebar mini 50x50 pixels -->
			<span class="logo-mini"><b>W</b>MS</span>
			<!-- logo for regular state and mobile devices -->
			<span class="logo-lg" th:utext="${auth.role.role}"> </span>

		</a>
		<!-- Header Navbar: style can be found in header.less -->
		<nav class="navbar navbar-static-top">
			<!-- Sidebar toggle button-->
			<a href="#" class="sidebar-toggle" data-toggle="offcanvas" role="button">
				<span class="sr-only">Toggle navigation</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</a>

			<div class="navbar-custom-menu">
				<ul class="nav navbar-nav">
					<!-- User Account: style can be found in dropdown.less -->
					<li class="dropdown user user-menu">
						<a href="#" class="dropdown-toggle" data-toggle="dropdown">
							<img th:src="@{/images/avatar5.png}" class="user-image" alt="User Image">
							<span class="hidden-xs" th:utext="${auth.name}"></span>
						</a>
						<ul class="dropdown-menu">
							<!-- User image -->
							<li class="user-header">
								<img th:src="@{/images/avatar5.png}" class="img-circle" alt="User Image">

								<p>
									<span class="hidden-xs" th:utext="${auth.name}"></span>
									<small><span class="hidden-xs" th:utext="${auth.email}"></span></small>
								</p>
							</li>
							<!-- Menu Body --
                            <!-- Menu Footer-->
							<li class="user-footer">
								<div class="pull-left">
									<a th:href="@{/myprofile/inf}" class="btn btn-primary btn-flat">Profile</a>
								</div>
								<div class="col-xs-offset-1 col-xs-4 text-center">
									<a  th:href="@{/myprofile/change_password(id=${auth.id})}"><i class="fa fa-gears"></i> Change
										Password</a>
								</div>
								<div class="pull-right">
									<a th:href="@{/logout}" class="btn btn-danger btn-flat">Sign out</a>
								</div>
							</li>
						</ul>
					</li>
				</ul>
			</div>
		</nav>
	</header>
	<!-- Left side column. contains the logo and sidebar -->
	<aside class="main-sidebar" th:insert="/navigator.html"></aside>
  <!-- Content Wrapper. Contains page content -->
  <div class="content-wrapper">
    <!-- Content Header (Page header) -->
    <section class="content-header">
      <h1>Report</h1>
      <ol class="breadcrumb">
        <li><a href="#"><i class="fa fa-download"></i>Allocated</a></li>
        <li><a href="/chart/download/utilizationreport.xlsx"><i class="fa fa-download"></i>Utilization</a></li>
      </ol>
      
    </section>

    <!-- Main content -->
    <section class="content">
      <div class="row">
        <div class="col-md-6">
          <!-- Allocated CHART -->
          <div class="box box-primary">
            <div class="box-header with-border">
              <h3 class="box-title">Allocated Chart</h3>

              <div class="box-tools pull-right">
              	<button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-download"></i>
                </button>
                <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i>
                </button>
                <button type="button" class="btn btn-box-tool" data-widget="remove"><i class="fa fa-times"></i></button>
              </div>
            </div>
            <div class="box-body">
              <div class="chart">
                <canvas id="allocatedContainer" style="height:250px"></canvas>
                <div id="js-legend1" class="js-legend"></div>
              </div>
            </div>
            <!-- /.box-body -->
          </div>
          <!-- /.box -->
	
          
          

        </div>
        <!-- /.col (LEFT) -->
        <div class="col-md-6">
          <!-- LINE CHART -->
          <div class="box box-info">
            <div class="box-header with-border">
              <h3 class="box-title">Utilization Chart</h3>

              <div class="box-tools pull-right">
                <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i>
                </button>
                <button type="button" class="btn btn-box-tool" data-widget="remove"><i class="fa fa-times"></i></button>
              </div>
            </div>
            <div class="box-body">
              <div class="chart">
                <canvas id="utilizationContainer" style="height:250px"></canvas>
                <div id="js-legend2" class="js-legend"></div>
              </div>
            </div>
            <!-- /.box-body -->
          </div>
          <!-- /.box -->

         

			

        </div>
        <!-- /.col (RIGHT) -->
      </div>
      <!-- /.row -->

		<div class="row">
		       <div class="col-md-12">
		<!-- BAR CHART -->
		     <div class="box box-success">
		       <div class="box-header with-border">
		         <h3 class="box-title">Allocated vs Utilized Chart</h3>
		
		         <div class="box-tools pull-right">
		           <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i>
		           </button>
		           <button type="button" class="btn btn-box-tool" data-widget="remove"><i class="fa fa-times"></i></button>
		         </div>
		       </div>
		       <div class="box-body">
		           <canvas id="utilizationBarContainer" ></canvas>
		           <div id="js-legend4" class="js-legend"></div>
		       </div>
		       <!-- /.box-body -->
		     </div>
		     <!-- /.box -->
		</div>
		 </div>
		    
    </section>
    <!-- /.content -->
  </div>
  <!-- /.content-wrapper -->
  <footer class="main-footer">
    <div class="pull-right hidden-xs">
      <a th:href="@{/home}">Workspace Management System</a>
    </div>
    <strong>Copyright &copy; 2019 SONY</strong> All rights
    reserved.
  </footer>
<!-- jQuery 2.2.3 -->
<script th:src="@{/js/jquery-2.2.3.min.js}"></script>
<!-- Bootstrap 3.3.6 -->
<script th:src="@{/js/bootstrap.min.js}"></script>
<!-- FastClick -->
<script th:src="@{/js/fastclick.js}"></script>
<!-- AdminLTE App -->
<script th:src="@{/js/app.min.js}"></script>
<!-- AdminLTE for demo purposes -->
<script th:src="@{/js/demo.js}"></script>
<!-- jQuery UI 1.11.4 -->
<script th:src="@{/js/jquery-ui.min.js}"></script>
<!-- Slimscroll -->
<script th:src="@{/js/jquery.slimscroll.min.js}"></script>


<!-- Morris.js charts -->
<script th:src="@{/js/raphael-min.js}"></script>
<script th:src="@{/js/morris.min.js}"></script>
<!-- ChartJS -->
<script th:src="@{/js/Chart.min.js}"></script>
<!-- Sparkline -->
<script th:src="@{/js/jquery.sparkline.min.js}"></script>
<!-- jQuery Knob Chart -->
<script th:src="@{/js/jquery.knob.js}"></script>
<!-- Bootstrap WYSIHTML5 -->
<script th:src="@{/js/bootstrap3-wysihtml5.all.min.js}"></script>
<script th:src="@{/js/scripts.js}"></script>
<script>


var allocated_dataPoints;
var assigned_dataPoints;
var options;
var options1;

function showChart() {
    $.ajax({
        url: '/chart/utilization',
       
        success: function (result) {
            var jsonData = JSON.parse(result);
       
			console.log(jsonData);
			allocated_dataPoints = jsonData.total_allocated;
			assigned_dataPoints = jsonData.total_assigned;
			//project_dataPoints = jsonData.project;
			utilizationBar_dataPoints = jsonData.utilizationBar;
			console.log(allocated_dataPoints);
			console.log(assigned_dataPoints);
			//console.log(project_dataPoints);
			console.log(utilizationBar_dataPoints);
			console.log(utilizationBar_dataPoints.xvalue);
			console.log(utilizationBar_dataPoints.allocated);
			console.log(utilizationBar_dataPoints.utilized);
			
			
						var allocated_DataPoints = [ {
							label : "Allocated",
							value : allocated_dataPoints.allocated,
							color : '#00a65a',
							highlight : '#00a65a'
						}, {
							label : "Unallocated",
							value : allocated_dataPoints.unallocated,
							color : '#f56954',
							highlight : '#f56954'
						} ]

						var assigned_DataPoints = [ {
							label : "Utilized",
							value : assigned_dataPoints.utilized,
							color : '#f39c12',
							highlight : '#f39c12'
						}, {
							label : "UnUtilized",
							value : assigned_dataPoints.unutilized,
							color : '#00c0ef',
							highlight : '#00c0ef'
						} ]

						var pieOptions = {
							//Boolean - Whether we should show a stroke on each segment
							segmentShowStroke : true,
							//String - The colour of each segment stroke
							segmentStrokeColor : '#fff',
							//Number - The width of each segment stroke
							segmentStrokeWidth : 2,
							//Number - The percentage of the chart that we cut out of the middle
							percentageInnerCutout : 50, // This is 0 for Pie charts
							//Number - Amount of animation steps
							animationSteps : 100,
							//String - Animation easing effect
							animationEasing : 'easeOutBounce',
							//Boolean - Whether we animate the rotation of the Doughnut
							animateRotate : true,
							//Boolean - Whether we animate scaling the Doughnut from the centre
							animateScale : false,
							//Boolean - whether to make the chart responsive to window resizing
							responsive : true,
							// Boolean - whether to maintain the starting aspect ratio or not when responsive, if set to false, will take up entire container
							maintainAspectRatio : true,
							//String - A legend template
							legendTemplate : '<ul class="<%=name.toLowerCase()%>-legend"><% for (var i=0; i<segments.length; i++){%><li><span style="background-color:<%=segments[i].fillColor%>"></span><%if(segments[i].label){%><%=segments[i].label%><%}%></li><%}%></ul>'
						}

						var allocatedCanvas = $('#allocatedContainer').get(0).getContext('2d')
						var allocatedChart = new Chart(allocatedCanvas)
						//allocatedChart.Doughnut(allocated_DataPoints, pieOptions)
						
						var myChart = allocatedChart.Pie(allocated_DataPoints)
  						document.getElementById("js-legend1").innerHTML = myChart.generateLegend();
						
						var assignedCanvas = $('#utilizationContainer').get(0).getContext('2d')
						var assignedChart = new Chart(assignedCanvas)
						//assignedChart.Doughnut(assigned_DataPoints, pieOptions)
						
						var myChart1 = assignedChart.Pie(assigned_DataPoints)
  						document.getElementById("js-legend2").innerHTML = myChart1.generateLegend();
						
							var utilizationBarChartData = {
							labels : utilizationBar_dataPoints.xvalue,
							datasets : [ {
									label : 'Allocated',
									fillColor : 'rgba(210, 214, 222, 1)',
									strokeColor : 'rgba(210, 214, 222, 1)',
									pointColor : 'rgba(210, 214, 222, 1)',
									pointStrokeColor : '#c1c7d1',
									pointHighlightFill : '#fff',
									pointHighlightStroke : 'rgba(220,220,220,1)',
									data :  utilizationBar_dataPoints.allocated
								}, {
									label : 'Utilized',
									fillColor : 'rgba(60,141,188,0.9)',
									strokeColor : 'rgba(60,141,188,0.8)',
									pointColor : '#3b8bba',
									pointStrokeColor : 'rgba(60,141,188,1)',
									pointHighlightFill : '#fff',
									pointHighlightStroke : 'rgba(60,141,188,1)',
									data :  utilizationBar_dataPoints.utilized
								} ]
							}
				
								//-------------
								//- BAR CHART -
								//-------------
								var utilizationBarChartCanvas = $('#utilizationBarContainer').get(0).getContext('2d')
								var utilizationBarChart = new Chart(utilizationBarChartCanvas)
								utilizationBarChartData.datasets[1].fillColor = '#00a65a'
								utilizationBarChartData.datasets[1].strokeColor = '#00a65a'
								utilizationBarChartData.datasets[1].pointColor = '#00a65a'
								var utilizationBarChartOptions = {
									scaleBeginAtZero : true,
									scaleShowGridLines : true,
									scaleGridLineColor : 'rgba(0,0,0,.05)',
									scaleGridLineWidth : 1,
									scaleShowHorizontalLines : true,
									scaleShowVerticalLines : true,
									barShowStroke : true,
									barStrokeWidth : 10,
									barValueSpacing : 50,
									barDatasetSpacing : 1,
									legendTemplate : '<ul class="<%=name.toLowerCase()%>-legend"><% for (var i=0; i<datasets.length; i++){%><li><span style="background-color:<%=datasets[i].fillColor%>"></span><%if(datasets[i].label){%><%=datasets[i].label%><%}%></li><%}%></ul>',
									responsive : true,
									maintainAspectRatio : true
								}
						
								utilizationBarChartOptions.datasetFill = false
								//utilizationBarChart.Bar(utilizationBarChartData, utilizationBarChartOptions)
								var myChart3 = utilizationBarChart.Bar(utilizationBarChartData, utilizationBarChartOptions);
  								document.getElementById("js-legend4").innerHTML = myChart3.generateLegend();

					},
					error : function(xhr, status, error) {
						var errorMessage = xhr.status + ': ' + xhr.statusText
						alert('Error - ' + errorMessage);
					}
				});
	}

	window.onload = function() {
		showChart();
	}

</script>
</body>
</html>