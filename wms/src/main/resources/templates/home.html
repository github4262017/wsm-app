<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	  xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>Workspace Management System | HOME</title>
	
	<meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">

	<link rel="stylesheet" th:href="@{/css/style.css}">
	<link rel="stylesheet" th:href="@{/css/bootstrap.min.css}">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.5.0/css/font-awesome.min.css">
	
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/ionicons/2.0.1/css/ionicons.min.css">
	
	<link rel="stylesheet" th:href="@{/css/AdminLTE.min.css}">
	
    <link rel="stylesheet" th:href="@{/css/_all-skins.min.css}">
    
    <link rel="stylesheet" th:href="@{/css/dataTables.bootstrap.css}">

	<link rel="stylesheet" th:href="@{/css/blue.css}">
	
	<link rel="icon" type="image/png" sizes="16x16" th:href="@{/images/favicon.png}"/>
	
</head>
<body class="hold-transition skin-blue sidebar-mini">
 <div class="se-pre-con"></div>
<div class="wrapper">

	<header class="main-header">
	
		<a th:href="@{/home}" class="logo">
			
			<span class="logo-mini"><b>W</b>MS</span>
		
			<span class="logo-lg" th:utext="${auth.role.role}"> </span>

		</a>
		
		<nav class="navbar navbar-static-top">
			

			<div class="navbar-custom-menu">
				<ul class="nav navbar-nav">
					
					<li class=" user user-menu">
						<img th:src="@{/images/avatar5.png}" class="user-image" alt="User Image">
							
						<ul class="dropdown-menu">
						
							<li class="user-header">
								<img th:src="@{/images/avatar5.png}" class="img-circle" alt="User Image">

								<p>
									<span class="hidden-xs" th:utext="${auth.name}"></span>
									<small><span class="hidden-xs" th:utext="${auth.email}"></span></small>
								</p>
							</li>
							
							<li class="user-footer">
								<div class="pull-left">
								
									<a  th:href="@{/myprofile/change_password(id=${auth.id})}"><i class="fa fa-gears"></i> Change
										Password</a>
								</div>
								
								<div class="pull-right">
									<a th:href="@{/logout}" class="btn btn-danger btn-flat">Sign out</a>
								</div>
							</li>
						</ul>
					</li>
					<li>
            <a href="#" data-toggle="control-sidebar"><i class="fa fa-gear"></i></a>
          </li>
				</ul>
			</div>
		</nav>
		
	</header>
	
	
	
	<aside class="main-sidebar" th:insert="/navigator.html"></aside>
	
	<div class="content-wrapper">
		
		<section class="content-header">
		
		</section>

		
		<section class="content">
			<div th:if="${control == 'Super Admin'}" >
				<div th:insert="/admin_home.html"></div>
			</div>
			<div th:if="${control == 'Facility Admin'}" >
				<div th:insert="/fa_home.html"></div>		
			</div>
			<div th:if="${control == 'Project Manager'}" >
				<div th:insert="/pm_home.html"></div>		
			</div>
        
        </div>

			
			
		</section>
	
	</div>
<footer class="main-footer">
    <div class="pull-right hidden-xs">
      <a th:href="@{/home}">Workspace Management System</a>
    </div>
    Copyright &copy; 2019 <strong>Four Corners Technologies</strong> All rights
    reserved.
  </footer>
	
  
<div th:insert="/logout.html"></div>

<!-- ./wrapper -->
<!-- jQuery 2.2.3 -->
<script th:src="@{/js/jquery-2.2.3.min.js}"></script>
<!-- Bootstrap 3.3.6 -->
<script th:src="@{/js/bootstrap.min.js}"></script>

<script th:src="@{/js/jquery.dataTables.min.js}"></script>
<script th:src="@{/js/dataTables.bootstrap.min.js}"></script>
<script th:src="@{/js/jquery.slimscroll.min.js}"></script>
<!-- FastClick -->

<!-- AdminLTE App -->
<script th:src="@{/js/app.min.js}"></script>
<!-- AdminLTE for demo purposes -->
<script th:src="@{/js/demo.js}"></script>
<script th:src="@{/js/scripts.js}"></script>

<script th:inline="javascript">
//console.log(projectnamewms);
    
$(function () {
    $('#allusers').DataTable();
    var authemail = [[${auth.email}]];
	//console.log(authemail);
	$('#authemail').html(authemail);
});


$(window).load(function(){
	console.log('element present'+$('#allusers').length);
	if($('#allusers').length>0){
		$('#allusers').DataTable();
		getAdminResponse(0); //for initial load get all user data so set value to 0
	}
	if($('#fahome').length>0){
		getFAResponse();
	}
	if($('#pmhome').length>0){
		getPMResponse();
	}
 });
 
function getPMResponse(){
	  var requestDetails = projectnamewms+'/PM/pmdashboard';
	   	$.ajax({
	  	    type: 'GET',
	  	    url: requestDetails,
	  	    contentType: "application/json",
	  	    dataType: 'json',
	  	    success: function (data) {
	  	    	console.log(data);
	  	    	$('#todayRequest').html(data.todayRequest);
	  	    	$('#allRequest').html(data.allRequest);
	  	    	$('#thisMonth').html(data.thisMonth);
	  	    	$('#pending').html(data.pending);
	  	    	$('#allocated').html(data.allocated);
	  	    	$('#assigned').html(data.assigned);
	  	    	$('#rejected').html(data.rejected);
	  	    },
	  	    
	  	    error: function (e) {
	  	      console.log("There was an error with your request...");
	  	      console.log("error: " + JSON.stringify(e));
	  	    }
	  	  });
}

function getFAResponse(){
	  var requestDetails = projectnamewms+'/FM/facilityadmincount';
	   	$.ajax({
	  	    type: 'GET',
	  	    url: requestDetails,
	  	    contentType: "application/json",
	  	    dataType: 'json',
	  	    success: function (data) {
	  	    	console.log(data);
	  	    	$('#todayRequest').html(data.todayRequest);
	  	    	$('#allRequest').html(data.allRequest);
	  	    	$('#thisMonth').html(data.thisMonth);
	  	    	$('#pending').html(data.pending);
	  	    	$('#allocated').html(data.allocated);
	  	    	$('#assigned').html(data.assigned);
	  	    	$('#rejected').html(data.rejected);
	  	    },
	  	    
	  	    error: function (e) {
	  	      console.log("There was an error with your request...");
	  	      console.log("error: " + JSON.stringify(e));
	  	    }
	  	  });
}
  
  function getAdminResponse(roleId){
	  var requestDetails = projectnamewms+'/superadmin/rolesinfo?roleId='+roleId;
	   	$.ajax({
	  	    type: 'GET',
	  	    url: requestDetails,
	  	    contentType: "application/json",
	  	    dataType: 'json',
	  	    success: function (data) {
	  	    	console.log(data);
	  	    	$('#pmCount').html(data.pmCount);
	  	    	$('#faCount').html(data.faCount);
	  	    	$('#dmCount').html(data.dmCount);
	  	    	$('#totalCount').html(data.totalCount);
	  	    	populateDataTable(data.userDetailsResponse);
	  	    },
	  	    
	  	    error: function (e) {
	  	      console.log("There was an error with your request...");
	  	      console.log("error: " + JSON.stringify(e));
	  	    }
	  	  });
  }
  
  
function populateDataTable(data) {
    console.log("populating data table...");
    $("#allusers").DataTable().clear();
    var length = Object.keys(data).length;
    console.log(length);
    for(var i = 0; i < length; i++) {
      var userDetailsResponse = data[i];
      var sno = i + 1;
      var group = getGroup(userDetailsResponse.role_id);
      console.log('userDetailsResponse'+userDetailsResponse + i);
    	   $('#allusers').dataTable().fnAddData( [
    		   sno,
    		   userDetailsResponse.firstname,
    		   userDetailsResponse.lastname,
    		   userDetailsResponse.email,
    		   group 
 	      ]);
    }
}
function getGroup(roleid){
	var group;
	if(roleid=='1'){
		group = 'Super Admin';
	}
	if(roleid=='2'){
		group = 'USER';	
		}
	if(roleid=='3'){
		group = 'Project Manager';
	}
	if(roleid=='4'){
		group = 'Facility Admin';
	}
	return group;
}
</script>




</body>
</html>