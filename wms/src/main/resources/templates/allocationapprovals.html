<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	  xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>Workspace Management System | Admin Approvals</title>
	<!-- Tell the browser to be responsive to screen width -->
	<meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
	
	<!-- Bootstrap 3.3.6 -->
	<link rel="stylesheet" th:href="@{/css/bootstrap.min.css}">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.5.0/css/font-awesome.min.css">
	<!-- Ionicons -->
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/ionicons/2.0.1/css/ionicons.min.css">
	 <!-- DataTables -->
  	<link rel="stylesheet" th:href="@{/css/dataTables.bootstrap.css}">
	<!-- Theme style -->
	<link rel="stylesheet" th:href="@{/css/AdminLTE.min.css}">
	<!-- AdminLTE Skins. Choose a skin from the css/skins
         folder instead of downloading all of them to reduce the load. -->
    <link rel="stylesheet" th:href="@{/css/_all-skins.min.css}">
    <link rel="stylesheet" th:href="@{/css/datepicker3.css}">
    <link rel="stylesheet" th:href="@{/css/style.css}">
	<!-- Theme style -->
	<!-- iCheck -->
	<link rel="stylesheet" th:href="@{/css/blue.css}">
	<!-- Morris chart -->
	<link rel="stylesheet" th:href="@{/css/morris.css}">
	<!-- bootstrap wysihtml5 - text editor -->
	<link rel="stylesheet" th:href="@{/css/bootstrap3-wysihtml5.min.css}">
	<link rel="icon" type="image/png" sizes="16x16" th:href="@{/images/wmsicon.png}"/>
	<!--[if lt IE 9]>
	<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
	<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.11.2/moment.min.js"></script>
	<![endif]-->
</head>
<style>
.js-legend ul {
  list-style: none;
}

.js-legend ul li {
  display: block;
  padding-left: 30px;
  position: relative;
  margin-bottom: 4px;
  border-radius: 5px;
  padding: 2px 8px 2px 28px;
  font-size: 14px;
  cursor: default;
  -webkit-transition: background-color 200ms ease-in-out;
  -moz-transition: background-color 200ms ease-in-out;
  -o-transition: background-color 200ms ease-in-out;
  transition: background-color 200ms ease-in-out;
}

.js-legend li span {
  display: block;
  position: absolute;
  left: 0;
  top: 0;
  width: 20px;
  height: 100%;
  border-radius: 5px;
}

</style>
<body class="hold-transition skin-blue sidebar-mini">
<div class="wrapper">

	<header class="main-header">
		<!-- Logo -->
		<a th:href="@{/home}" class="logo">
			<!-- mini logo for sidebar mini 50x50 pixels -->
			<span class="logo-mini"><b>M</b>RT</span>
			<!-- logo for regular state and mobile devices -->
			<span class="logo-lg" th:utext="${auth.role.role}"> </span>

		</a>
		<!-- Header Navbar: style can be found in header.less -->
		<nav class="navbar navbar-static-top">
			<!-- Sidebar toggle button-->
			<a href="#" class="sidebar-toggle" data-toggle="offcanvas" role="button">
				<span class="sr-only">Toggle navigation</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</a>

			<div class="navbar-custom-menu">
				<ul class="nav navbar-nav">
					<!-- User Account: style can be found in dropdown.less -->
					<li class="dropdown user user-menu">
						<a href="#" class="dropdown-toggle" data-toggle="dropdown">
							<img th:src="@{/images/avatar5.png}" class="user-image" alt="User Image">
							<span class="hidden-xs" th:utext="${auth.name}"></span>
						</a>
						<ul class="dropdown-menu">
							<!-- User image -->
							<li class="user-header">
								<img th:src="@{/images/avatar5.png}" class="img-circle" alt="User Image">

								<p>
									<span class="hidden-xs" th:utext="${auth.name}"></span>
									<small><span class="hidden-xs" th:utext="${auth.email}"></span></small>
								</p>
							</li>
							<!-- Menu Body --
                            <!-- Menu Footer-->
							<li class="user-footer">
								<div class="pull-left">
									<a th:href="@{/myprofile/inf}" class="btn btn-primary btn-flat">Profile</a>
								</div>
								<div class="col-xs-offset-1 col-xs-4 text-center">
									<a  th:href="@{/myprofile/change_password(id=${auth.id})}"><i class="fa fa-gears"></i> Change
										Password</a>
								</div>
								<div class="pull-right">
									<a th:href="@{/logout}" class="btn btn-danger btn-flat">Sign out</a>
								</div>
							</li>
						</ul>
					</li>
				</ul>
			</div>
		</nav>
	</header>
	<!-- Left side column. contains the logo and sidebar -->
	<aside class="main-sidebar" th:insert="/navigator.html"></aside>

 <!-- Content Wrapper. Contains page content -->
  <div class="content-wrapper">
    <!-- Content Header (Page header) -->


    <!-- Main content -->
    <section class="content">
      <div class="row">
        <div class="col-xs-12">
          <div class="box">
            <div class="box-header">
              <h3 class="box-title">Allocation Approvals</h3>
            </div>
            <!-- /.box-header -->
            <div class="box-body">
              <table id="example1" class="table table-bordered table-striped">
				<thead>
					<tr>
						<th>Request_ID</th>
						<th>Project Manager</th>
						<th>Department</th>
						<th>Project Name</th>
						<th>No.Of Resource</th> 
						<th>TypeOfDesk</th>
					 <th>StartTime</th>
						<th>EndTime</th>
						<th>Status</th>
						<th>De-allocate</th>
						<th>Remarks</th>
					<!--  	
						
						 -->
						
					</tr>
				</thead>
				</table>
            </div>
            <!-- /.box-body -->
          </div>
          <!-- /.box -->
        </div>
        <!-- /.col -->
      </div>
      <!-- /.row -->
    </section>
    <!-- /.content -->
    
<div class="modal fade" id="rejectrequestmodal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-md">
    <div class="modal-content RejectRequest" style = "display:block;">
      <form role="form" id="rejectrequestform" method="post" action="/allocation/updatepmrequest">
        <div class="modal-header">
          <h6 class= "wmsmodalheading">Reject Request</h6>
          <!-- <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>-->
        </div>
        <div class="modal-body">
          <h4 style = "text-align : center;"> Are you sure you want to reject this Request?</h4>
          <div class="col-md-12"> 
            <div class="form-group row">
              <label for="inputRequestid" class="col-sm-4 control-label">Request ID</label>
              <div class = "col-sm-8">
                 <span class="form-control" name="request_id" id="reject_requestid"/></span>
              </div>
            </div>
          </div>
          <div class="col-md-12">
            <div class="form-group row">
              <label for="inputRejection" class="col-sm-4 control-label">Reason of Rejection</label>
              <div class = "col-sm-8">
                <textarea class="form-control" placeholder="Enter Your Remarks Here" name="remarks" autocomplete="off" required></textarea>
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer" >
          <button type="submit" class="btn btn-success rejectrequestid">Reject</button>
          <button type="button" class="btn btn-danger cancelrequestid" data-dismiss="modal" >Cancel</button>
        </div>
      </form>
    </div>
    <div class="modal-content RejectedRequest" style = "display:none;">
      <div class="modal-header">
        <button type="button" class="close rejclose" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
      </div>
      <div class="modal-body">
   
        <h2 class= "rejected-h2">Request Rejected</h2>
      
      </div>
      <div class="modal-footer" >
        <button type="button" class="btn btn-danger rejclose" data-dismiss="modal" >Close</button> 
      </div>
    </div>
  </div>
</div>
  </div>
  <!-- /.content-wrapper -->
  <footer class="main-footer">
    <div class="pull-right hidden-xs">
      <a th:href="@{/home}">Workspace Management System</a>
    </div>
    <strong>Copyright &copy; 2019 SONY</strong> All rights
    reserved.
  </footer>
  
<!-- jQuery 2.2.3 -->
<script th:src="@{/js/jquery-2.2.3.min.js}"></script>
<!-- Bootstrap 3.3.6 -->
<script th:src="@{/js/bootstrap.min.js}"></script>
<!-- DataTables -->
<script th:src="@{/js/jquery.dataTables.min.js}"></script>
<script th:src="@{/js/dataTables.bootstrap.min.js}"></script>
<!-- FastClick -->
<script th:src="@{/js/fastclick.js}"></script>
<!-- AdminLTE App -->
<script th:src="@{/js/app.min.js}"></script>
<!-- AdminLTE for demo purposes -->
<script th:src="@{/js/demo.js}"></script>
<!-- jQuery UI 1.11.4 -->
<script th:src="@{/js/jquery-ui.min.js}"></script>
<!-- Slimscroll -->
<script th:src="@{/js/jquery.slimscroll.min.js}"></script>


<!-- Morris.js charts -->
<script th:src="@{/js/raphael-min.js}"></script>
<script th:src="@{/js/morris.min.js}"></script>
<!-- ChartJS -->
<script th:src="@{/js/Chart.min.js}"></script>
<!-- Sparkline -->
<script th:src="@{/js/jquery.sparkline.min.js}"></script>
<!-- jQuery Knob Chart -->
<script th:src="@{/js/jquery.knob.js}"></script>
<!-- Bootstrap WYSIHTML5 -->
<script th:src="@{/js/bootstrap3-wysihtml5.all.min.js}"></script>
<script th:src="@{/js/scripts.js}"></script>

<script>



$(function() {
	  $("#example1").DataTable({
		  "processing": true,
	         //"sAjaxSource":"response.php",
	         "dom": 'lBfrtip',
		  "buttons": [
		              {
		                  extend: 'collection',
		                  text: 'Export',
		                  buttons: [
		                      'copy',
		                      'excel',
		                      'csv',
		                      'pdf',
		                      'print'
		                  ]
		              }
		          ]
	  }
			  );
	  
	  $(document).ready(function(){
			loadData();
		});

	  // Premade test data, you can also use your own
	  //var testDataUrl = "https://raw.githubusercontent.com/chennighan/RapidlyPrototypeJavaScript/master/lesson4/data.json"
	  var testDataUrl = "/allocation/approval?id=8";

	  function loadData() {
	    $.ajax({
	      type: 'GET',
	      url: testDataUrl,
	      contentType: "application/json",
	      dataType: 'json',
	      success: function (data) {
	        myJsonData = data;
	        console.log("myJsonData: " + myJsonData);
	        populateDataTable(myJsonData);
	        
	      },
	      error: function (e) {
	        console.log("There was an error with your request...");
	        console.log("error: " + JSON.stringify(e));
	      }
	    });
	  }

	  // populate the data table with JSON data
	  function populateDataTable(data) {
	    console.log("populating data table...");
	    // clear the table before populating it with more data
	    $("#example").DataTable().clear();
	    var length = Object.keys(data).length;
	    for(var i = 0; i < length; i++) {
	      var allocationReq = data[i];
	      // if status is Pending
	      if (allocationReq.status == 'Pending'){
	      // You could also use an ajax property on the data table initialization
	      $('#example1').dataTable().fnAddData( [
	    	  allocationReq.request_id,
	    	  allocationReq.pm_id,
	    	  allocationReq.department_id,
	    	  allocationReq.project_id,
	    	  allocationReq.no_of_resource,
	    	  allocationReq.typeofdesk,
	    	 allocationReq.start_time,
	    	  allocationReq.end_time,
	    	  "<a class='btn btn-success approveID' id = '"+allocationReq.request_id+"' style = 'font-size:5px'><i class='fa fa-check' style = 'font-size:10px'></i></a>"+
	    	  "&nbsp;<a class='btn btn-danger rejectID' id = '"+allocationReq.request_id+"' data-toggle = 'modal' data-target = '#rejectrequestmodal' style = 'font-size:5px'><i class='fa fa-close' style = 'font-size:10px'></i></a>",
	    	  "<span class='label label-default'>De-allocate</span>",
	    	  allocationReq.remarks
	      ]);
	      }
	   // if status is Rejected
	      else if (allocationReq.status == 'Rejected'){
	    	  // You could also use an ajax property on the data table initialization
		      $('#example1').dataTable().fnAddData( [
		    	  allocationReq.request_id,
		    	  allocationReq.pm_id,
		    	  allocationReq.department_id,
		    	  allocationReq.project_id,
		    	  allocationReq.no_of_resource,
		    	  allocationReq.typeofdesk,
		    	 allocationReq.start_time,
		    	  allocationReq.end_time,
		    	  "<span class='label label-danger'>Rejected</span>",
		    	  "<span class='label label-default'>De-allocate</span>",
		    	  allocationReq.remarks
		      ]);
	      }
	   // if status is Accepted
	      else if (allocationReq.status == 'Accepted'){
	    	  // You could also use an ajax property on the data table initialization
		      $('#example1').dataTable().fnAddData( [
		    	  allocationReq.request_id,
		    	  allocationReq.pm_id,
		    	  allocationReq.department_id,
		    	  allocationReq.project_id,
		    	  allocationReq.no_of_resource,
		    	  allocationReq.typeofdesk,
		    	 allocationReq.start_time,
		    	  allocationReq.end_time,
		    	  "<span class='label label-success'>Allocated</span>",
		    	 
		    	  "<span  id = '"+allocationReq.request_id+"' style = 'cursor:pointer' class='label label-danger deallocateID'>De-allocate</span>",
		    	  allocationReq.remarks
		      ]); 
	      }
	      else if (allocationReq.status == 'Allocated'){
	    	  // You could also use an ajax property on the data table initialization
		      $('#example1').dataTable().fnAddData( [
		    	  allocationReq.request_id,
		    	  allocationReq.pm_id,
		    	  allocationReq.department_id,
		    	  allocationReq.project_id,
		    	  allocationReq.no_of_resource,
		    	  allocationReq.typeofdesk,
		    	 allocationReq.start_time,
		    	  allocationReq.end_time,
		    	  "<span class='label label-success'>Allocated</span>",
		    	 
		    	  "<span  id = '"+allocationReq.request_id+"' style = 'cursor:pointer' class='label label-danger deallocateID'>De-allocate</span>",
		    	  allocationReq.remarks
		      ]); 
	      }
	      else if (allocationReq.status == 'Deallocated'){
	    	  // You could also use an ajax property on the data table initialization
		      $('#example1').dataTable().fnAddData( [
		    	  allocationReq.request_id,
		    	  allocationReq.pm_id,
		    	  allocationReq.department_id,
		    	  allocationReq.project_id,
		    	  allocationReq.no_of_resource,
		    	  allocationReq.typeofdesk,
		    	 allocationReq.start_time,
		    	  allocationReq.end_time,
		    	  "<span class='label label-default'>De-allocated</span>",
		    	 
		    	  "<span class='label label-default'>De-allocated</span>",
		    	  allocationReq.remarks
		      ]); 
	      }
	      
	    }
	    
	  
			$('#example1').on('click', '.rejectID', function() {
				var request_id = $(this).attr('id');
				console.log(request_id);
				$('#reject_requestid').html(request_id);
			});
			
			$('#example1').on('click', '.approveID', function() {
				var request_id = $(this).attr('id');
				//console.log(request_id);
				document.location.href = '/myprofile/fa-allocation-request?requestid='+request_id;
				
			});
			
			//deallocate url
			
			$('#example1').on('click', '.deallocateID', function() {
				var request_id = $(this).attr('id');
				console.log(request_id);
				document.location.href = '/myprofile/fa-deallocation-request?requestid='+request_id;
				
			});


		}

	  $("#rejectrequestform").submit(function(event) {
			event.preventDefault(); //prevent default action 
			var post_url = $(this).attr("action"); //get form action url
			var request_method = $(this).attr("method"); //get form GET/POST method
			var form_data = $(this).serialize(); //Encode form elements for submission
			var request_id = $('#reject_requestid').text();
			console.log(request_id);
			$.ajax({
				url : post_url + '?request_id='+request_id,
				//url : post_url,
				type : request_method,
				data : form_data
			}).done(function(response) {
				console.log('successfully worked');
				console.log(response);
				console.log(response.successMsg);
				 $('.RejectRequest').css("display", 'none');
		         $('.RejectedRequest').css("display", 'block');
				//$(".alert").show();
				//$(".alert-success").html('<i class="icon fa fa-check"></i>'+response.successMsg);
			});
		});
	})
</script>
</body>
</html>